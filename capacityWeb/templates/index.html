{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>千岛湖承载量预警平台-主页</title>

    <!-- StyleSheet -->
    <link rel="stylesheet" href="{% static 'font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel='stylesheet' href="{% static 'css/Bmap.selfdef.css' %}">
    <link rel="shortcut icon" href="{% static 'img/icon.ico' %}" type="image/x-icon">
    <!-- JavaScript-->
    <script src="{% static 'js/jquery-3.4.1.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/jquery-ui.min.js' %}"></script>
    <script src="{% static 'js/amcharts.js' %}"></script>
    <script src="{% static 'js/serial.js' %}"></script>
    <script src="{% static 'js/pie.js' %}"></script>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=1CFZXuwC6qpsMqryPHz6s1xzVSjbiKqR"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#mynavbar">
                <span class="sr-only">切换导航</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{% url 'capacityWeb:index' %}"><img src="{% static 'img/logo.jpg' %}" alt="">千岛湖承载量预警平台</a>
        </div>
        <div class="collapse navbar-collapse navbar-right" id="mynavbar">
            <ul class="nav navbar-nav">
                <li class="active"><a href="{% url '[capacityWeb]:index' %}"><i class="fa fa-home"></i>主页</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="false"><i
                            class="fa fa-star"></i>景点详情<span
                            class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{% url 'capacityWeb:meifeng' %}"><i class="fa fa-star"></i>梅峰岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url 'capacityWeb:huangshanjian' %}"><i class="fa fa-star"></i>黄山尖</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:tianchi' %}"><i class="fa fa-star"></i>天池岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:yueguang' %}"><i class="fa fa-star"></i>月光岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:longsha' %}"><i class="fa fa-star"></i>龙山岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:yule' %}"><i class="fa fa-star"></i>渔乐岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:guihua' %}"><i class="fa fa-star"></i>桂花岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:mishan' %}"><i class="fa fa-star"></i>蜜山岛</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="false"><i
                            class="fa fa-bar-chart"></i>承载力分析<span
                            class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{% url 'capacityWeb:mfanalysis' %}"><i class="fa fa-bar-chart"></i>梅峰岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url 'capacityWeb:hsanalysis' %}"><i class="fa fa-bar-chart"></i>黄山尖</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:tcanalysis' %}"><i class="fa fa-bar-chart"></i>天池岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:yganalysis' %}"><i class="fa fa-bar-chart"></i>月光岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:lsanalysis' %}"><i class="fa fa-bar-chart"></i>龙山岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:ylanalysis' %}"><i class="fa fa-bar-chart"></i>渔乐岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:ghanalysis' %}"><i class="fa fa-bar-chart"></i>桂花岛</a></li>
                        <li class="divider"></li>
                        <li><a href="{% url '[capacityWeb]:msanalysis' %}"><i class="fa fa-bar-chart"></i>蜜山岛</a></li>
                    </ul>
                </li>
                <li><a href="{% url '[capacityWeb]:admin_warn' %}"><i class="fa fa-history"></i>预警管理</a></li>
                <li><a href="{% url '[capacityWeb]:admin' %}"><i class="fa fa-folder"></i>后台管理</a></li>
                <li><a href="{% url '[capacityWeb]:logout' %}" title="退出登录"><span class="glyphicon glyphicon-off"></span></a></li>
            </ul>
        </div>
    </div>
</nav>
<div class="container-fluid container-main">
    <div class="col-md-3 col-sm-12" id="col1">
        <div class="container-block col-md-12" id="numdata">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-users"></i> 游客人数</div>
            </div>
            <div class="container-content" id="container-numdata">
                <div class="numdata-line title">本日人数</div>
                <div class="numdata-line title">同比变化率</div>
                <div class="numdata-line title">环比变化率</div>
                <div class="numdata-line data">{{ rn_sum_day }}<span class="unit"> 人</span></div>
                {% if rn_sum_day_yoy > 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-up"
                                                      aria-hidden="true"
                                                      style="color: red"></i>{{ rn_sum_day_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rn_sum_day_yoy < 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-down"
                                                      aria-hidden="true"
                                                      style="color: green"></i>{{ rn_sum_day_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="numdata-line data"><i class="fa fa-minus"
                                                      aria-hidden="true"
                                                      style="color: orange"></i>{{ rn_sum_day_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
                {% if rn_sum_day_dod > 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-up"
                                                      aria-hidden="true"
                                                      style="color: red"></i>{{ rn_sum_day_dod|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rn_sum_day_dod < 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-down"
                                                      aria-hidden="true"
                                                      style="color: green"></i>{{ rn_sum_day_dod|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="numdata-line data"><i class="fa fa-minus"
                                                      aria-hidden="true"
                                                      style="color: orange"></i>{{ rn_sum_day_dod|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
                <div class="numdata-line title">本周人数</div>
                <div class="numdata-line title">同比变化率</div>
                <div class="numdata-line title">环比变化率</div>
                <div class="numdata-line data">{{ rn_sum_week }}<span class="unit"> 人</span></div>
                {% if rn_sum_week_yoy > 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-up"
                                                      aria-hidden="true"
                                                      style="color: red"></i>{{ rn_sum_week_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rn_sum_week_yoy < 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-down"
                                                      aria-hidden="true"
                                                      style="color: green"></i>{{ rn_sum_week_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="numdata-line data"><i class="fa fa-minus"
                                                      aria-hidden="true"
                                                      style="color: orange"></i>{{ rn_sum_week_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
                {% if rn_sum_week_wow > 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-up"
                                                      aria-hidden="true"
                                                      style="color: red"></i>{{ rn_sum_week_wow|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rn_sum_week_wow < 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-down"
                                                      aria-hidden="true"
                                                      style="color: green"></i>{{ rn_sum_week_wow|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="numdata-line data"><i class="fa fa-minus"
                                                      aria-hidden="true"
                                                      style="color: orange"></i>{{ rn_sum_week_wow|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
                <div class="numdata-line title">本月人数</div>
                <div class="numdata-line title">同比变化率</div>
                <div class="numdata-line title">环比变化率</div>
                <div class="numdata-line data">{{ rn_sum_month }}<span class="unit"> 人</span></div>
                {% if rn_sum_month_yoy > 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-up"
                                                      aria-hidden="true"
                                                      style="color: red"></i>{{ rn_sum_month_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rn_sum_month_yoy < 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-down"
                                                      aria-hidden="true"
                                                      style="color: green"></i>{{ rn_sum_month_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="numdata-line data"><i class="fa fa-minus"
                                                      aria-hidden="true"
                                                      style="color: orange"></i>{{ rn_sum_month_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
                {% if rn_sum_month_mom > 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-up"
                                                      aria-hidden="true"
                                                      style="color: red"></i>{{ rn_sum_month_mom|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rn_sum_month_mom < 0 %}
                    <div class="numdata-line data"><i class="fa fa-arrow-down"
                                                      aria-hidden="true"
                                                      style="color: green"></i>{{ rn_sum_month_mom|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="numdata-line data"><i class="fa fa-minus"
                                                      aria-hidden="true"
                                                      style="color: orange"></i>{{ rn_sum_month_mom|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
            </div>
        </div>
        <div class="container-block col-md-12" id="scenicrank">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-list-ul"></i> 景区人数排行</div>
                <div class="container-tag">本日</div>
            </div>
            <div class="container-content" id="container-scenicrank">

            </div>
        </div>
        <div class="container-block col-md-12" id="current-warning">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-warning"></i> 最新预警</div>
                <div class="container-tag">{{ today2day }}</div>
            </div>
            <div class="container-content" id="container-warning">
                {% if not curwarn %}
                    <div class="nowarning">暂无紧急情况</div>
                {% endif %}
                {% for item in curwarn %}
                    {% if item.type == 1 and item.level == 1 %}
                        <a class="content-curwarn col-md-12" onclick="showModalWarn({{ item.warningId }})"
                           style="background-color: rgba(255,19,0,0.7)">
                            <span class="happen-time">- {{ item.createAtMin }} -</span>
                            {{ item.scenicName }}-{{ item.level }}级承载量预警
                            <span class="exceed-nums">超预警值：{{ item.exceedNums }}</span>
                        </a>
                    {% elif item.type == 1 and item.level == 2 %}
                        <a class="content-curwarn col-md-12" onclick="showModalWarn({{ item.warningId }})"
                           style="background-color: rgb(255,163,0);">
                            <span class="happen-time">- {{ item.createAtMin }} -</span>
                            {{ item.scenicName }}-{{ item.level }}级承载量预警
                            <span class="exceed-nums">超预警值：{{ item.exceedNums }}</span>
                        </a>
                    {% elif item.type == 1 and item.level == 3 %}
                        <a class="content-curwarn col-md-12" onclick="showModalWarn({{ item.warningId }})"
                           style="background-color: rgb(83,171,255);">
                            <span class="happen-time">- {{ item.createAtMin }} -</span>
                            {{ item.scenicName }}-{{ item.level }}级承载量预警
                            <span class="exceed-nums">超预警值：{{ item.exceedNums }}</span>
                        </a>
                    {% elif item.type == 2 %}
                        <a class="content-curwarn col-md-12" onclick="showModalWarn({{ item.warningId }})"
                           style="background-color: rgba(255,19,0,0.7);">
                            <span class="happen-time">- {{ item.createAtMin }} -</span>
                            {{ item.scenicName }}-摄像头{{ item.camId }}-游客出没
                        </a>
                    {% elif item.type == 3 %}
                        <a class="content-curwarn col-md-12" onclick="showModalWarn({{ item.warningId }})"
                           style="background-color: rgba(255,19,0,0.7);">
                            <span class="happen-time">- {{ item.createAtMin }} -</span>
                            {{ item.scenicName }}-摄像头{{ item.camId }}-游客打架
                        </a>
                    {% elif item.type == 5 %}
                        <a class="content-curwarn col-md-12" onclick="showModalWarn({{ item.warningId }})"
                           style="background-color: rgba(255,19,0,0.7);">
                            <span class="happen-time">- {{ item.createAtMin }} -</span>
                            {{ item.scenicName }}-摄像头{{ item.camId }}-游客吸烟
                        </a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="col-md-6  col-sm-12" id="col2">
        <div class="container-block col-md-12" id="heatmap-tourist">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-map-marker"></i> 人群热力图</div>
                <div class="container-tag">热力图</div>
            </div>
            <div class="container-content" id="container-heatmap-tour">

            </div>
            <button onclick="fullscreen_click(this)" id="heatmap-tourist-full"><img
                    src="{% static 'img/fullscreen.svg' %}"
                    alt="fullscreen"></button>
            <div class="modal fade" id="modal-vid">
                <div class="modal-dialog" style="width:65%">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">监控视频</h4>
                        </div>
                        <div class="modal-body">
                            <p class="modal-number">当前人数:<span id="modal-vid-count">0</span></p>
                            <video id="vid1" autoplay="autoplay"
                                   style="height: 100%;width: 100%;object-fit: fill;"></video>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="modal-replay">
                <div class="modal-dialog" style="width:70%">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">视频回放</h4>
                        </div>
                        <div class="modal-body">
                            <video id="vid2" controls autoplay="autoplay"
                                   style="height: 100%;width: 100%;object-fit: fill;" src=""></video>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="modal-warn">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">预警详情</h4>
                        </div>
                        <div class="modal-body">
                            <table>
                                <tr>
                                    <th>预警位置</th>
                                    <th id="scenicPlace"></th>
                                </tr>
                                <tr>
                                    <th>预警等级</th>
                                    <th id="level"></th>
                                </tr>
                                <tr>
                                    <th>预警类型</th>
                                    <th id="type"></th>
                                </tr>
                                <tr>
                                    <th>发生时间</th>
                                    <th id="curtime"></th>
                                </tr>
                                <tr>
                                    <th>超预警人数</th>
                                    <th id="exceedNums"></th>
                                </tr>
                                <tr>
                                    <th>负责人</th>
                                    <th id="admin"></th>
                                </tr>
                                <tr>
                                    <th>电话</th>
                                    <th id="phone"></th>
                                </tr>
                                <tr>
                                    <th>状态</th>
                                    <th id="state"></th>
                                </tr>
                                <tr>
                                    <th>画面</th>
                                    <th>
                                        <img id="pic" src="" alt="无" width="350">
                                        <button class="btn btn-info" id="replay_btn">视频回放</button>
                                    </th>
                                </tr>
                                <tr>
                                    <th>操作</th>
                                    <th id="notice">
                                        <button class="btn btn-info" id="notice_btn">通知</button>
                                    </th>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-block col-md-12" id="numbar">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-bar-chart-o"></i> 景区承载量</div>
                <div class="container-tag">当前情况</div>
            </div>
            <div class="container-content" id="container-numbar">

            </div>
        </div>
    </div>
    <div class="col-md-3 col-sm-12" id="col3">
        <div class="container-block col-md-12" id="warndata">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-exclamation"></i> 预警次数</div>
            </div>
            <div class="container-content" id="container-warndata">
{#                <div class="warndata-line title">本日预警次数</div>#}
{#                <div class="warndata-line title">同比变化率</div>#}
{#                <div class="warndata-line title">环比变化率</div>#}
{#                <div class="warndata-line data">{{ rw_count_day }}<span class="unit"> 次</span></div>#}
{#                {% if rw_count_day_yoy > 0 %}#}
{#                    <div class="warndata-line data"><i class="fa fa-arrow-up"#}
{#                                                       aria-hidden="true"#}
{#                                                       style="color: red"></i>{{ rw_count_day_yoy|floatformat:2 }}<span#}
{#                            class="unit"> %</span></div>#}
{#                {% elif rw_count_day_yoy < 0 %}#}
{#                    <div class="warndata-line data"><i class="fa fa-arrow-down"#}
{#                                                       aria-hidden="true"#}
{#                                                       style="color: green"></i>{{ rw_count_day_yoy|floatformat:2 }}<span#}
{#                            class="unit"> %</span></div>#}
{#                {% else %}#}
{#                    <div class="warndata-line data"><i class="fa fa-minus"#}
{#                                                       aria-hidden="true"#}
{#                                                       style="color: orange"></i>{{ rw_count_day_yoy|floatformat:2 }}<span#}
{#                            class="unit"> %</span></div>#}
{#                {% endif %}#}
{#                {% if rw_count_day_dod > 0 %}#}
{#                    <div class="warndata-line data"><i class="fa fa-arrow-up"#}
{#                                                       aria-hidden="true"#}
{#                                                       style="color: red"></i>{{ rw_count_day_dod|floatformat:2 }}<span#}
{#                            class="unit"> %</span></div>#}
{#                {% elif rw_count_day_dod < 0 %}#}
{#                    <div class="warndata-line data"><i class="fa fa-arrow-down"#}
{#                                                       aria-hidden="true"#}
{#                                                       style="color: green"></i>{{ rw_count_day_dod|floatformat:2 }}<span#}
{#                            class="unit"> %</span></div>#}
{#                {% else %}#}
{#                    <div class="warndata-line data"><i class="fa fa-minus"#}
{#                                                       aria-hidden="true"#}
{#                                                       style="color: orange"></i>{{ rw_count_day_dod|floatformat:2 }}<span#}
{#                            class="unit"> %</span></div>#}
{#                {% endif %}#}

                <div class="warndata-line title">本周预警次数</div>
                <div class="warndata-line title">同比变化率</div>
                <div class="warndata-line title">环比变化率</div>
                <div class="warndata-line data">{{ rw_count_week }}<span class="unit"> 次</span></div>
                {% if rw_count_week_yoy > 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-up"
                                                       aria-hidden="true"
                                                       style="color: red"></i>{{ rw_count_week_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rw_count_week_yoy < 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-down"
                                                       aria-hidden="true"
                                                       style="color: green"></i>{{ rw_count_week_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="warndata-line data"><i class="fa fa-minus"
                                                       aria-hidden="true"
                                                       style="color: orange"></i>{{ rw_count_week_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
                {% if rw_count_week_wow > 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-up"
                                                       aria-hidden="true"
                                                       style="color: red"></i>{{ rw_count_week_wow|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rw_count_week_wow < 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-down"
                                                       aria-hidden="true"
                                                       style="color: green"></i>{{ rw_count_week_wow|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="warndata-line data"><i class="fa fa-minus"
                                                       aria-hidden="true"
                                                       style="color: orange"></i>{{ rw_count_week_wow|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}

                <div class="warndata-line title">本月预警次数</div>
                <div class="warndata-line title">同比变化率</div>
                <div class="warndata-line title">环比变化率</div>
                <div class="warndata-line data">{{ rw_count_month }}<span class="unit"> 次</span></div>
                {% if rw_count_month_yoy > 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-up"
                                                       aria-hidden="true"
                                                       style="color: red"></i>{{ rw_count_month_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rw_count_month_yoy < 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-down"
                                                       aria-hidden="true"
                                                       style="color: green"></i>{{ rw_count_month_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="warndata-line data"><i class="fa fa-minus"
                                                       aria-hidden="true"
                                                       style="color: orange"></i>{{ rw_count_month_yoy|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
                {% if rw_count_month_mom > 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-up"
                                                       aria-hidden="true"
                                                       style="color: red"></i>{{ rw_count_month_mom|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% elif rw_count_month_mom < 0 %}
                    <div class="warndata-line data"><i class="fa fa-arrow-down"
                                                       aria-hidden="true"
                                                       style="color: green"></i>{{ rw_count_month_mom|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% else %}
                    <div class="warndata-line data"><i class="fa fa-minus"
                                                       aria-hidden="true"
                                                       style="color: orange"></i>{{ rw_count_month_mom|floatformat:2 }}<span
                            class="unit"> %</span></div>
                {% endif %}
            </div>
        </div>
        <div class="container-block col-md-12" id="warnrank1">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-list-ul"></i> I级预警排行</div>
                <div class="container-tag">本日</div>
            </div>
            <div class="container-content" id="container-warnrank1">
                <div class="nowarning2">今日暂无I级预警</div>
            </div>
        </div>
        <div class="container-block col-md-12" id="warnrank2">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-list-ul"></i> II级预警排行</div>
                <div class="container-tag">本日</div>
            </div>
            <div class="container-content" id="container-warnrank2">
                <div class="nowarning2">今日暂无II级预警</div>
            </div>
        </div>
        <div class="container-block col-md-12" id="warnrank3">
            <div class="container-header">
                <div class="container-title"><i class="fa fa-list-ul"></i> III级预警排行</div>
                <div class="container-tag">本日</div>
            </div>
            <div class="container-content" id="container-warnrank3">
                <div class="nowarning2">今日暂无III级预警</div>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'js/baidu-map-flashMarker.js' %}"></script>
<script type="text/javascript">
    // 百度地图API功能，游客人数热力图
    var map = new BMap.Map("container-heatmap-tour", {enableMapClick: false});    // 创建Map实例
    var zoom_tour_num = 12;
    var marker_tour_array = [];
    var camera_tour_array = [];
    map.centerAndZoom(new BMap.Point(118.918175, 29.570947), 11);  // 初始化地图,设置中心点坐标和地图级别
    map.setCurrentCity("杭州");          // 设置地图显示的城市 此项是必须设置的
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放

    // 清除所有标注物
    function clearAllMarkers(map, marker_array) {
        var i;
        for (i = 0; i < marker_array.length; i++) {
            map.removeOverlay(marker_array[i]);
        }
        marker_array.length = 0;
    }

    function addOverHandler_tour(id, name, content, marker, bounce = 1) {
        var info_window_tour = {
            width: 200,     // 信息窗口宽度
            height: 60,     // 信息窗口高度
            title: name, // 信息窗口标题
            enableMessage: true //设置允许信息窗发送短息
        };
        if (bounce) {
            marker.setAnimation(BMAP_ANIMATION_BOUNCE); // 标注跳动
        }
        var info_timeout;
        // 标注物点击事件
        marker.addEventListener("mouseover", function (e) {
                if (info_timeout != null) {
                    clearTimeout(info_timeout);
                    info_timeout = null;
                }
                var p = e.target;
                var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                var infoWindow_tour = new BMap.InfoWindow(content, info_window_tour);  // 创建信息窗口对象
                map.openInfoWindow(infoWindow_tour, point); //开启信息窗口
            }
        );
        {#// 标注物鼠标离开事件#}
        {#marker.addEventListener("mouseout", function (e) {#}
        {#        clearTimeout(info_timeout);#}
        {#        info_timeout = setTimeout("map.closeInfoWindow()", 2000);#}
        {#    }#}
        {#);#}
        // 标注物点击事件
        marker.addEventListener("click", function (e) {
                if (id == 1)
                    window.location.href = "{% url '[capacityWeb]:meifeng' %}";
                else if (id == 2)
                    window.location.href = "{% url '[capacityWeb]:huangshanjian' %}";
                else if (id == 3)
                    window.location.href = "{% url '[capacityWeb]:tianchi' %}";
                else if (id == 4)
                    window.location.href = "{% url '[capacityWeb]:yueguang' %}";
                else if (id == 5)
                    window.location.href = "{% url '[capacityWeb]:longsha' %}";
                else if (id == 6)
                    window.location.href = "{% url '[capacityWeb]:yule' %}";
                else if (id == 7)
                    window.location.href = "{% url '[capacityWeb]:guihua' %}";
                else if (id == 8)
                    window.location.href = "{% url '[capacityWeb]:mishan' %}";
            }
        );
    }

    var citys = [];

    // 加载闪动点
    function heatmap_scenic() {
        $.ajax({
            url: '/getHeatMapScenic/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: true,
            success: function (arg) {
                // 若调用成功，向地图添加标记
                var obj_cap = jQuery.parseJSON(arg)[0];
                rn_obj = obj_cap['rn_data'];
                for (var i = 0; i < rn_obj.length; i++) {
                    city = {};
                    city['name'] = rn_obj[i].scenicName; // 景区名
                    city['lnglat'] = [rn_obj[i].lng, rn_obj[i].lat]; // 坐标点
                    city['type'] = 'circle';
                    var point = new BMap.Point(rn_obj[i].lng, rn_obj[i].lat);
                    var icon = new BMap.Icon('{% static "img/circle.svg" %}', new BMap.Size(5, 5), {
                        'anchor': new BMap.Size(10, 10)
                    });
                    var marker = new BMap.Marker(point, {icon: icon}); // 标注物
                    var nums = rn_obj[i].nums;
                    var warning1 = rn_obj[i].warning1Nums;
                    var warning2 = rn_obj[i].warning2Nums;
                    var warning3 = rn_obj[i].warning3Nums;
                    city['warning1'] = warning1;
                    if (nums < warning3) {
                        city['color'] = '#53abff';
                        city['speed'] = 0.2;
                        city['status'] = '空闲';
                    } else if (nums < warning2) {
                        city['color'] = '#ffb700';
                        city['speed'] = 0.2;
                        city['status'] = '拥挤';
                    } else if (nums < warning1) {
                        city['color'] = '#ff7e00';
                        city['speed'] = 0.2;
                        city['status'] = '饱和';
                    } else {
                        city['color'] = '#d81e06';
                        city['speed'] = 0.5;
                        city['status'] = '爆满';
                    }
                    map.addOverlay(marker);
                    marker_tour_array.push(marker);
                    citys.push(city);
                }
                var flashMarkerLayer = new FlashMarker(map, citys);
            }
        });
    }

    // 加载热力图
    function heatmap_nums() {
        // 清除所有摄像头分布
        clearAllMarkers(map, camera_tour_array);
        // 坐标点
        $.ajax({
            url: '/getHeatMapNums/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: true,
            success: function (arg) {
                // 若调用成功，向地图添加标记
                var obj_tour = jQuery.parseJSON(arg)[0];
                // 各摄像头的统计对象
                cam_points_obj = obj_tour['rn_data'];
                // 景区标注对象
                scenic_points_obj = obj_tour['scenic_data'];
                var points = [];
                var scenicnums = [];
                // 初始化景区人数之和
                for (i = 0; i < scenic_points_obj.length; i++) {
                    scenicnums[i] = 0;
                }
                // 统计各摄像头信息
                for (i = 0; i < cam_points_obj.length; i++) {
                    points.push({
                        'lng': cam_points_obj[i].camLng,
                        'lat': cam_points_obj[i].camLat,
                        'count': cam_points_obj[i].all_nums
                    });
                    scenicnums[cam_points_obj[i].scenicId - 1] += cam_points_obj[i].all_nums;
                }
                // 添加标注物
                for (var i = 0; i < scenic_points_obj.length; i++) {
                    var point = new BMap.Point(scenic_points_obj[i].fields.lng, scenic_points_obj[i].fields.lat); // 坐标点
                    var marker = new BMap.Marker(point); // 标注物
                    map.addOverlay(marker);
                    marker_tour_array.push(marker);
                    var info_context = "实时游客量/承载量：" + scenicnums[i] + "/" + citys[i]['warning1'] + "<br>当前状态:" + citys[i]['status'];
                    addOverHandler_tour(i + 1, scenic_points_obj[i].fields.scenicname, info_context, marker);
                }
                heatmapOverlay = new BMapLib.HeatmapOverlay({"radius": 20});
                map.addOverlay(heatmapOverlay);
                heatmapOverlay.setDataSet({data: points, max: 100});
                heatmapOverlay.show();
            }
        });
    }

    var vidcount_itv;

    // 加载摄像头分布
    function heatmap_get_tour_camera() {
        clearAllMarkers(map, marker_tour_array);
        $.ajax({
            url: '/getHeatMapCamera/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: true,
            success: function (arg) {
                // 若调用成功，向地图添加标记
                var camera_obj = jQuery.parseJSON(arg)[0]['camera_data'];
                var icon = new BMap.Icon('{% static 'img/camera.svg' %}', new BMap.Size(20, 32),
                    {
                        'anchor': new BMap.Size(10, 20)
                    });
                // 统计各摄像头信息
                for (i = 0; i < camera_obj.length; i++) {
                    var point = new BMap.Point(camera_obj[i].camLng, camera_obj[i].camLat); // 坐标点
                    var marker = new BMap.Marker(point, {icon: icon}); // 标注物
                    var vid_name = 'vid_s' + camera_obj[i].scenicId + '_c1.mp4';
                    if (camera_obj[i].scenicId == 1 && camera_obj[i].camId == 2) {
                        vid_name = 'vid_s1_c2.mp4';
                    }
                    var cam_name = '监控视频 - ' + camera_obj[i].camPlace;
                    //自定义参数id
                    marker.vid_name = vid_name;
                    marker.cam_name = cam_name;
                    // 添加事件
                    marker.addEventListener("click", function (e) {
                        var modal = $("#modal-vid").modal({
                            backdrop: true, // 相当于data-backdrop
                            keyboard: false, // 相当于data-keyboard
                            show: true, // 相当于data-show
                            remote: "" // 相当于a标签作为触发器的href
                        });
                        // var modal = $("#modal-vid").modal();
                        modal.find('.modal-title').text(e.target.cam_name);
                        modal.find('.modal-body video').attr("src", "/static/video/" + e.target.vid_name);
                        modal.find('#modal-vid-count').text(0);
                        // 开始检测视频
                        $.ajax({
                            url: '/startDetectCount_thread/',
                            type: 'POST',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}', 'vid_name': e.target.vid_name,
                            },
                            async: false,
                            success: function (arg) {
                                var arg_json = JSON.parse(arg);
                                // alert(arg_json.msg);
                            }
                        });

                        function getDetectCount_vid() {
                            $.ajax({
                                url: '/getCountNum_thread/',
                                type: 'POST',
                                data: {
                                    csrfmiddlewaretoken: '{{ csrf_token }}'
                                },
                                async: false,
                                success: function (arg) {
                                    var arg_json = JSON.parse(arg);
                                    modal.find('#modal-vid-count').text(arg_json.count);
                                }
                            });
                        }

                        vidcount_itv = setInterval(getDetectCount_vid, 1000);
                    });
                    map.addOverlay(marker);
                    camera_tour_array.push(marker);
                }
            }
        });
    }

    // 层级缩放事件
    map.addEventListener("zoomend", function () {
        var zoom_num_now = map.getZoom();
        // 如果之前的层级小于17，而现在的层级大于等于17，加载热力图
        if (zoom_tour_num < 17 && zoom_num_now >= 17) {
            heatmap_get_tour_camera();
        }
        // 如果之前的层级大于等于17，而现在的层级小于17，加载摄像头
        else if (zoom_tour_num >= 17 && zoom_num_now < 17) {
            heatmap_nums();
        }
        zoom_tour_num = zoom_num_now
    });
    // 加载事件，首次加载，默认执行
    map.addEventListener("addtilelayer", function () {
        heatmap_nums();
    });
    heatmap_scenic();
    // 视频模态框
    $('#modal-vid').on('show.bs.modal', function () {
        var $this = $(this);
        var $modal_dialog = $this.find('.modal-dialog');
        $this.css('display', 'block');
        $modal_dialog.css({'margin-top': Math.max(0, ($(window).height() - $modal_dialog.height()) / 2)});
    });
    $('#modal-vid').on('hidden.bs.modal', function () {
        // 关闭定时
        clearInterval(vidcount_itv);
        // 关闭线程
        $.ajax({
            url: '/exitDetectCount_thread/',
            type: 'POST',
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            async: false,
            success: function (arg) {
                var arg_json = JSON.parse(arg);
            }
        });
        // 视频暂停
        var video = document.getElementById('vid1');
        video.pause();
    });
</script>
<script type="text/javascript">
    var chart;
    var chartData1 = {{ scenicrank_data }};

    // SERIAL CHART
    chart = new AmCharts.AmSerialChart();
    chart.dataProvider = chartData1;
    chart.categoryField = "scenic";
    chart.startDuration = 1;
    chart.rotate = true;
    chart.marginTop = 2;
    chart.marginLeft = 0;
    chart.fontSize = 14;

    // AXES
    // category
    var categoryAxis = chart.categoryAxis;
    categoryAxis.gridPosition = "start";
    categoryAxis.axisColor = "#c3c3c3";
    categoryAxis.dashLength = 3;
    categoryAxis.fontSize = 12;

    // value
    var valueAxis = new AmCharts.ValueAxis();
    valueAxis.dashLength = 3;
    valueAxis.axisAlpha = 0.2;
    valueAxis.position = "bottom";
    valueAxis.minorGridEnabled = true;
    valueAxis.minorGridAlpha = 0.08;
    valueAxis.gridAlpha = 0.15;
    valueAxis.fontSize = 10;
    chart.addValueAxis(valueAxis);

    // GRAPHS
    // column graph
    var graph1 = new AmCharts.AmGraph();
    graph1.type = "column";
    graph1.title = "人数";
    graph1.valueField = "nums";
    graph1.lineAlpha = 0;
    graph1.fillColors = "#607fd9";
    graph1.fillAlphas = 0.8;
    graph1.balloonText = "<span style='font-size:13px;'>[[title]] - [[category]]:<b>[[value]]</b></span>";
    chart.hideBalloonTime = 5000;
    chart.addGraph(graph1);

    // WRITE
    chart.write("container-scenicrank");
</script>
<script type="text/javascript">
    var chart;

    var chartData1 = {{ warnrank1_data }};
    // SERIAL CHART
    chart = new AmCharts.AmSerialChart();
    chart.dataProvider = chartData1;
    chart.categoryField = "scenic";
    chart.startDuration = 1;
    chart.rotate = true;
    chart.marginTop = 2;
    chart.marginLeft = 0;
    chart.fontSize = 14;

    // AXES
    // category
    var categoryAxis = chart.categoryAxis;
    categoryAxis.gridPosition = "start";
    categoryAxis.axisColor = "#c3c3c3";
    categoryAxis.dashLength = 3;
    categoryAxis.fontSize = 12;

    // value
    var valueAxis = new AmCharts.ValueAxis();
    valueAxis.dashLength = 3;
    valueAxis.axisAlpha = 0.2;
    valueAxis.position = "bottom";
    valueAxis.minorGridEnabled = true;
    valueAxis.minorGridAlpha = 0.08;
    valueAxis.gridAlpha = 0.15;
    valueAxis.fontSize = 10;
    chart.addValueAxis(valueAxis);

    // GRAPHS
    // column graph
    var graph1 = new AmCharts.AmGraph();
    graph1.type = "column";
    graph1.title = "预警次数";
    graph1.valueField = "times";
    graph1.lineAlpha = 0;
    graph1.fillColors = "#d92202";
    graph1.fillAlphas = 0.8;
    graph1.balloonText = "<span style='font-size:13px;'>[[title]] - [[category]]:<b>[[value]]</b></span>";
    chart.addGraph(graph1);

    // WRITE
    if (chartData1.length != 0) {
        chart.write("container-warnrank1");
    }
</script>
<script type="text/javascript">
    var chart2;

    var chartData2 = {{ warnrank2_data }};
    // SERIAL CHART
    chart2 = new AmCharts.AmSerialChart();
    chart2.dataProvider = chartData2;
    chart2.categoryField = "scenic";
    chart2.startDuration = 1;
    chart2.rotate = true;
    chart2.marginTop = 2;
    chart2.marginLeft = 0;
    chart2.fontSize = 14;

    // AXES
    // category
    var categoryAxis = chart2.categoryAxis;
    categoryAxis.gridPosition = "start";
    categoryAxis.axisColor = "#c3c3c3";
    categoryAxis.dashLength = 3;
    categoryAxis.fontSize = 12;

    // value
    var valueAxis = new AmCharts.ValueAxis();
    valueAxis.dashLength = 3;
    valueAxis.axisAlpha = 0.2;
    valueAxis.position = "bottom";
    valueAxis.minorGridEnabled = true;
    valueAxis.minorGridAlpha = 0.08;
    valueAxis.gridAlpha = 0.15;
    valueAxis.fontSize = 10;
    chart2.addValueAxis(valueAxis);

    // GRAPHS
    // column graph
    var graph1 = new AmCharts.AmGraph();
    graph1.type = "column";
    graph1.title = "预警次数";
    graph1.valueField = "times";
    graph1.lineAlpha = 0;
    graph1.fillColors = "#ff9900";
    graph1.fillAlphas = 0.8;
    graph1.balloonText = "<span style='font-size:13px;'>[[title]] - [[category]]:<b>[[value]]</b></span>";
    chart2.addGraph(graph1);

    // WRITE
    if (chartData2.length != 0) {
        chart2.write("container-warnrank2");
    }
</script>
<script type="text/javascript">
    var chart3;

    var chartData3 = {{ warnrank3_data }};
    // SERIAL CHART
    chart3 = new AmCharts.AmSerialChart();
    chart3.dataProvider = chartData3;
    chart3.categoryField = "scenic";
    chart3.startDuration = 1;
    chart3.rotate = true;
    chart3.marginTop = 2;
    chart3.marginLeft = 0;
    chart3.fontSize = 14;

    // AXES
    // category
    var categoryAxis = chart3.categoryAxis;
    categoryAxis.gridPosition = "start";
    categoryAxis.axisColor = "#c3c3c3";
    categoryAxis.dashLength = 3;
    categoryAxis.fontSize = 12;

    // value
    var valueAxis = new AmCharts.ValueAxis();
    valueAxis.dashLength = 3;
    valueAxis.axisAlpha = 0.2;
    valueAxis.position = "bottom";
    valueAxis.minorGridEnabled = true;
    valueAxis.minorGridAlpha = 0.08;
    valueAxis.gridAlpha = 0.15;
    valueAxis.fontSize = 10;
    chart3.addValueAxis(valueAxis);

    // GRAPHS
    // column graph
    var graph1 = new AmCharts.AmGraph();
    graph1.type = "column";
    graph1.title = "预警次数";
    graph1.valueField = "times";
    graph1.lineAlpha = 0;
    graph1.fillColors = "#00ced9";
    graph1.fillAlphas = 0.8;
    graph1.balloonText = "<span style='font-size:13px;'>[[title]] - [[category]]:<b>[[value]]</b></span>";
    chart3.addGraph(graph1);

    // WRITE
    if (chartData3.length != 0) {
        chart3.write("container-warnrank3");
    }
</script>
<script type="text/javascript">
    function update_numbar() {
        $.ajax({
            url: '/updateNumbar/',
            type: 'POST',
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            async: false,
            success: function (arg) {
                var chart;
                var chartData3 = JSON.parse(arg)['numbar_data_bymin'];
                // SERIAL CHART
                chart = new AmCharts.AmSerialChart();
                chart.dataProvider = chartData3;
                chart.categoryField = "scenic";
                chart.startDuration = 1;

                chart.handDrawn = true;
                chart.handDrawnScatter = 3;

                // AXES
                // category
                var categoryAxis = chart.categoryAxis;
                categoryAxis.gridPosition = "start";

                // value
                var valueAxis = new AmCharts.ValueAxis();
                valueAxis.axisAlpha = 0;
                chart.addValueAxis(valueAxis);

                // value
                var valueAxis2 = new AmCharts.ValueAxis();
                valueAxis2.axisAlpha = 0;
                valueAxis2.position = "right";
                valueAxis2.minimum = 0;
                valueAxis2.maximum = 1;
                chart.addValueAxis(valueAxis2);

                // GRAPHS
                // column graph
                var graph1 = new AmCharts.AmGraph();
                graph1.type = "column";
                graph1.title = "瞬间极限容量";
                graph1.lineColor = "#00d570";
                graph1.valueField = "limitNums";
                graph1.lineAlpha = 1;
                graph1.fillAlphas = 1;
                graph1.dashLengthField = "dashLengthColumn";
                graph1.alphaField = "alpha";
                graph1.balloonText = "<span style='font-size:13px;'>[[title]] - [[category]]:<b>[[value]]</b> [[additional]]</span>";
                chart.addGraph(graph1);

                // line
                var graph2 = new AmCharts.AmGraph();
                graph2.type = "line";
                graph2.title = "当前人数";
                graph2.lineColor = "#fcd202";
                graph2.valueField = "nums";
                graph2.lineThickness = 3;
                graph2.bullet = "round";
                graph2.bulletBorderThickness = 3;
                graph2.bulletBorderColor = "#fcd202";
                graph2.bulletBorderAlpha = 1;
                graph2.bulletColor = "#ffffff";
                graph2.dashLengthField = "dashLengthLine";
                graph2.balloonText = "<span style='font-size:13px;'>[[title]] - [[category]]:<b>[[value]]</b> [[additional]]</span>";
                chart.addGraph(graph2);

                // line
                var graph3 = new AmCharts.AmGraph();
                graph3.type = "line";
                graph3.title = "承载力系数";
                graph3.lineColor = "#607fd9";
                graph3.valueField = "ratio";
                graph3.lineThickness = 3;
                graph3.bullet = "triangleUp";
                graph3.bulletBorderThickness = 3;
                graph3.bulletBorderColor = "#607fd9";
                graph3.bulletBorderAlpha = 1;
                graph3.bulletColor = "#ffffff";
                graph3.dashLengthField = "dashLengthLine";
                graph3.balloonText = "<span style='font-size:13px;'>[[title]] - [[category]]:<b>[[value]]</b> [[additional]]</span>";
                graph3.valueAxis = valueAxis2;
                chart.addGraph(graph3);

                // legend
                {#var legend = new AmCharts.AmLegend();#}
                {#legend.markerBorderColor = "#000000";#}
                {#legend.switchType = undefined;#}
                {#legend.align = "center";#}
                {#legend.top = 20;#}
                {#chart.addLegend(legend);#}
                // WRITE
                chart.write("container-numbar");
            }
        });
    }

    update_numbar();
    setInterval(update_numbar, 600000);
</script>
<script>
    $('li').click(function () {
        $("li.active").removeClass("active");
        $(this).addClass("active");
    });

    // 进入全屏
    function launchFullscreen(obj_id) {
        var element = document.getElementById(obj_id.substring(0, obj_id.length - 5));
        var button_img = document.querySelector("#" + obj_id + " > img");
        button_img.setAttribute('src', '/static/img/exit-fullscreen.svg');
        if (element.requestFullscreen) {
            element.requestFullscreen();
        } else if (element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
        } else if (element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen();
        }
    }

    //退出全屏
    function exitFullscreen(obj_id) {
        var de = document;
        var button_img = document.querySelector("#" + obj_id + " > img");
        button_img.setAttribute('src', '/static/img/fullscreen.svg');
        if (de.exitFullscreen) {
            de.exitFullscreen();
        } else if (de.mozCancelFullScreen) {
            de.mozCancelFullScreen();
        } else if (de.webkitCancelFullScreen) {
            de.webkitCancelFullScreen();
        }
    }

    // 判断是否全屏
    function isFullscreenForNoScroll() {
        var explorer = window.navigator.userAgent.toLowerCase();
        if (explorer.indexOf('chrome') > 0) {//webkit
            return !(document.body.scrollHeight === window.screen.height && document.body.scrollWidth === window.screen.width);
        } else {
            //IE 9+  fireFox
            return window.outerHeight === window.screen.height && window.outerWidth === window.screen.width;
        }
    }

    function fullscreen_click(obj) {
        var flag = isFullscreenForNoScroll();
        if (flag) {
            launchFullscreen(obj.id);
        } else {
            exitFullscreen(obj.id);
        }
    }

    function repeat(str, n) {
        return new Array(n + 1).join(str);
    }

    function showModalWarn(id) {
        $.ajax({
            url: '/getWarnDataById/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}', 'warningId': id},
            async: false,
            success: function (arg) {
                var obj = JSON.parse(arg)[0];
                var modal = $("#modal-warn").modal({
                    backdrop: true, // 相当于data-backdrop
                    keyboard: false, // 相当于data-keyboard
                    show: true, // 相当于data-show
                    remote: "" // 相当于a标签作为触发器的href
                });
                modal.find('#scenicPlace').text(obj.scenicName);
                modal.find('#level').text(repeat('I', obj.level));
                modal.find('#pic').attr('src', '');
                var typeId = obj.type;
                var typeName = null;
                if (typeId == 1) {
                    typeName = '承载量预警';
                } else if (typeId == 2) {
                    typeName = '游客出没';
                    modal.find('#pic').attr('src', '/static/img/warning' + id + '.jpg');
                    modal.find('#replay_btn').attr('onclick', 'replay_person()');
                } else if (typeId == 3) {
                    typeName = '打架';
                    modal.find('#pic').attr('src', '/static/img/warning' + id + '.jpg');
                    modal.find('#replay_btn').attr('onclick', 'replay_fight()');
                } else {
                    typeName = '吸烟';
                    modal.find('#pic').attr('src', '/static/img/warning' + id + '.jpg');
                    modal.find('#replay_btn').attr('onclick', 'replay_smoke()');
                }
                modal.find('#type').text(typeName);
                modal.find('#curtime').text(obj.createAt);
                modal.find('#exceedNums').text(obj.exceedNums);
                var stateId = obj.state;
                var state = null;
                if (stateId == 1) {
                    state = '未通知';
                } else {
                    state = '已通知'
                }
                modal.find('#state').text(state);
                modal.find('#admin').text(obj.name);
                modal.find('#phone').text(obj.phone);
                modal.find('#notice_btn').attr("onclick", "Notice( " + id + " )");
            }
        });
    }

    function Notice(id) {
        $.ajax({
            url: '/capacityWeb/notice/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}', 'warningId': id},
            async: false,
            success: function (arg) {
                var obj = JSON.parse(arg);
                alert(obj.msg);
            }
        });
    }

    function DetectWarn() {
        $.ajax({
            url: '/capacityWeb/DetectWarn/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: false,
            success: function (arg) {
                var arg_json = jQuery.parseJSON(arg);
                var i;
                for (i = 0; i < arg_json.length; i++) {
                    var obj = arg_json[i];
                    var level = obj['level'];
                    var type = obj['type'];
                    var exceedNums = obj['exceedNums'];
                    var ScenicName = obj['ScenicName'];
                    var warningId = obj['warningId'];
                    var createAt = obj['createAt'];
                    var camId = obj['camId'];
                    if (type == 1 && level == 1) {
                        $('#container-warning').prepend('<a class="content-curwarn col-md-12" onclick="showModalWarn(' + warningId + ')"style="background-color: rgba(255,19,0,0.7)"> <span class="happen-time">- ' + createAt.substr(11, 5) + '  -</span>' + ScenicName + '-1级承载量预警 <span class="exceed-nums">超预警值：' + exceedNums + ' </span> </a>');
                    } else if (type == 1 && level == 2) {
                        $('#container-warning').prepend('<a class="content-curwarn col-md-12" onclick="showModalWarn(' + warningId + ')"style="background-color: rgb(255,163,0)"> <span class="happen-time">- ' + createAt.substr(11, 5) + '  -</span>' + ScenicName + '-2级承载量预警 <span class="exceed-nums">超预警值：' + exceedNums + ' </span> </a>');
                    } else if (type == 1 && level == 3) {
                        $('#container-warning').prepend('<a class="content-curwarn col-md-12" onclick="showModalWarn(' + warningId + ')"style="background-color: rgb(83,171,255)"> <span class="happen-time">- ' + createAt.substr(11, 5) + '  -</span>' + ScenicName + '-3级承载量预警 <span class="exceed-nums">超预警值：' + exceedNums + ' </span> </a>');
                    } else if (type == 2) {
                        $('#container-warning').prepend('<a class="content-curwarn col-md-12" onclick="showModalWarn(' + warningId + ')"style="background-color: rgba(255,19,0,0.7)"> <span class="happen-time">- ' + createAt.substr(11, 5) + '  -</span>' + ScenicName + '-摄像头' + camId + '-游客出没 </a>');
                    } else if (type == 3) {
                        $('#container-warning').prepend('<a class="content-curwarn col-md-12" onclick="showModalWarn(' + warningId + ')"style="background-color: rgba(255,19,0,0.7)"> <span class="happen-time">- ' + createAt.substr(11, 5) + '  -</span>' + ScenicName + '-摄像头' + camId + '-游客打架 </a>');
                    } else if (type == 5) {
                        $('#container-warning').prepend('<a class="content-curwarn col-md-12" onclick="showModalWarn(' + warningId + ')"style="background-color: rgba(255,19,0,0.7)"> <span class="happen-time">- ' + createAt.substr(11, 5) + '  -</span>' + ScenicName + '-摄像头' + camId + '-游客吸烟 </a>');
                    }
                    showModalWarn(warningId);
                }
            }
        });
    }

    setInterval(DetectWarn, 30000);

    function start_person() {
        $.ajax({
            url: '/start_run_person/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: false,
            success: function (arg) {
                // var arg_json = JSON.parse(arg);
                // alert(arg_json.msg);
            }
        });
    }

    var interval;

    function detect_person() {
        $.ajax({
            url: '/detect_run_person/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: false,
            success: function (arg) {
                var arg_json = JSON.parse(arg);
                var state = arg_json['state'];
                if (state) {
                    // alert('发现游客出没');
                    // DetectWarn();
                    clearInterval(interval);
                }
            }
        });
    }

    function run_person() {
        start_person();
        interval = setInterval(detect_person, 10000);
    }

    function start_fight() {
        $.ajax({
            url: '/start_run_fight/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: false,
            success: function (arg) {
                var arg_json = JSON.parse(arg);
                // alert(arg_json.msg);
            }
        });
    }

    function detect_fight() {
        $.ajax({
            url: '/detect_run_fight/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: false,
            success: function (arg) {
                var arg_json = JSON.parse(arg);
                var state = arg_json['state'];
                if (state) {
                    // alert('发现游客出没');
                    // DetectWarn();
                    clearInterval(interval);
                }
            }
        });
    }

    function run_fight() {
        start_fight();
        interval = setInterval(detect_fight, 10000);
    }

    function start_smoke() {
        $.ajax({
            url: '/start_run_smoke/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: false,
            success: function (arg) {
                var arg_json = JSON.parse(arg);
                // alert(arg_json.msg);
            }
        });
    }

    function detect_smoke() {
        $.ajax({
            url: '/detect_run_smoke/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            async: false,
            success: function (arg) {
                var arg_json = JSON.parse(arg);
                var state = arg_json['state'];
                if (state) {
                    // alert('发现游客出没');
                    // DetectWarn();
                    clearInterval(interval);
                }
            }
        });
    }

    function run_smoke() {
        start_smoke();
        interval = setInterval(detect_smoke, 10000);
    }

    function replay_person() {
        var modal = $("#modal-replay").modal({
            backdrop: true, // 相当于data-backdrop
            keyboard: false, // 相当于data-keyboard
            show: true, // 相当于data-show
            remote: "" // 相当于a标签作为触发器的href
        });
        modal.find('#vid2').attr('src', '/static/darknet/video/person_replay.mp4');
    }

    function replay_fight() {
        var modal = $("#modal-replay").modal({
            backdrop: true, // 相当于data-backdrop
            keyboard: false, // 相当于data-keyboard
            show: true, // 相当于data-show
            remote: "" // 相当于a标签作为触发器的href
        });
        modal.find('#vid2').attr('src', '/static/darknet2/video/fight_replay.mp4');
    }

    function replay_smoke() {
        var modal = $("#modal-replay").modal({
            backdrop: true, // 相当于data-backdrop
            keyboard: false, // 相当于data-keyboard
            show: true, // 相当于data-show
            remote: "" // 相当于a标签作为触发器的href
        });
        modal.find('#vid2').attr('src', '/static/darknet3/video/smoke_replay.mp4');
    }

    // run_person();
    // run_fight();
    // run_smoke();
</script>
</body>
</html>